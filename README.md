# Malware Download Scanner Chrome Extension

이 크롬 확장 프로그램은 웹 브라우징 보안을 강화하기 위해 설계되었습니다. 파일 다운로드를 가로채서 원격 서버로 악성코드 분석을 요청하고, 해당 파일이 안전하다고 판단될 경우에만 다운로드를 진행합니다. 이러한 선제적 접근 방식은 사용자가 잠재적으로 악성 파일에 노출되기 전에 로컬 시스템에 저장되는 것을 방지하여 보호합니다.

---

## 작동 방식

확장 프로그램은 크롬의 다운로드 시스템과 통합되어 다음과 같이 작동합니다:

1.  **다운로드 가로채기**: 사용자가 파일 다운로드를 시작하면 확장 프로그램이 즉시 이를 가로챕니다.
2.  **원본 다운로드 취소**: 브라우저가 시작한 원본 다운로드는 취소되고 제거됩니다. 이는 분석 전에 파일이 사용자 컴퓨터에 직접 다운로드되지 않도록 합니다.
3.  **서버 분석 요청**: 원본 다운로드 URL과 추출된 파일명이 지정된 Flask 서버로 분석을 위해 전송됩니다.
4.  **분석 결과 처리**:
    * 서버가 파일이 **악성**이라고 판단하면 다운로드는 차단되고 사용자에게 알림이 표시됩니다.
    * 서버가 파일이 **안전**하다고 판단하면 확장 프로그램은 원본 URL에서 다운로드를 다시 시작하여 사용자가 파일을 안전하게 얻을 수 있도록 합니다.
5.  **파일명 처리**: 확장 프로그램은 크롬의 `downloadItem`, `Content-Disposition` 헤더, URL 경로 또는 쿼리 매개변수 등 다양한 소스에서 가장 적절한 원본 파일명을 추출하고, 로컬 파일 시스템 호환성을 위해 이를 정제하는 강력한 로직을 포함합니다.

---

## 주요 기능

* **선제적 악성코드 검사**: 다운로드를 가로채서 파일이 사용자 장치에 도달하기 전에 서버 측 검사를 수행합니다.
* **실시간 보호**: 파일 안전성에 대한 즉각적인 피드백을 제공합니다.
* **다운로드 관리**: 분석 결과에 따라 다운로드를 원활하게 취소하고 다시 시작합니다.
* **정확한 파일명 추출**: 정확한 보고 및 안전한 로컬 저장을 위해 원본 파일명을 지능적으로 결정합니다.
* **사용자 알림**: 차단된 악성 파일 또는 성공적으로 안전하게 다운로드된 파일에 대해 사용자에게 알립니다.
* **중복 요청 방지**: 동일한 URL에 대한 중복 분석 요청을 방지합니다.

---

## 기술 세부 정보

### `background.js`

이 스크립트는 확장 프로그램의 핵심 로직을 처리하는 서비스 워커입니다.

* **`SERVER_URL`**: 파일 분석을 담당하는 Flask 서버의 주소(예: 제공된 코드에서는 `http://165.246.34.137:8080`).
* **`urlsUnderAnalysis`**: 중복 요청을 방지하기 위해 현재 분석 중인 URL을 추적하는 **Set**입니다.
* **`urlsToSkipNextOnCreated`**: 확장 프로그램 자체가 다시 시작한 다운로드 URL을 관리하여 재분석 루프를 방지하는 **Set**입니다.
* **`sanitizeFilename(filename)`**: 파일 시스템에서 허용되지 않는 문자 및 경로 구성 요소를 제거하여 파일명을 정리하고 로컬 파일 시스템과의 호환성을 보장하는 유틸리티 함수입니다.
* **`getBestOriginalFilename(downloadItem)`**: `downloadItem` 객체, `Content-Disposition` 헤더 또는 URL 자체에서 가장 정확한 원본 파일명을 지능적으로 추출하는 비동기 헬퍼 함수입니다.
* **`chrome.downloads.onCreated.addListener`**: 다운로드 가로채기, 서버 통신, 그리고 분석 결과에 따른 다운로드 관리를 트리거하는 주요 이벤트 리스너입니다. 초기 다운로드를 취소하고, URL과 파일명을 서버로 전송한 다음, 다운로드를 차단하거나 다시 시작하는 로직을 포함합니다.

### `manifest.json`

이 파일은 확장 프로그램의 메타데이터, 권한 및 백그라운드 스크립트를 선언합니다.

* **`manifest_version`**: 3 (크롬 확장 프로그램의 최신 표준인 Manifest V3).
* **`name`**: "Malware Download Scanner".
* **`description`**: "다운로드 파일을 서버에 전송하여 악성 여부를 판단하고, 안전할 경우에만 다운로드를 진행합니다."
* **`permissions`**:
    * `downloads`: 크롬의 다운로드 시스템에 접근하고 관리하는 데 필요합니다 (다운로드 가로채기, 취소, 다시 시작).
    * `notifications`: 사용자에게 알림을 표시하는 데 필요합니다 (예: 다운로드 차단됨, 다운로드 허용됨).
    * `storage`: 확장 프로그램 설정 또는 데이터를 저장하는 데 사용될 수 있습니다 (제공된 `background.js`에서는 명시적으로 사용되지 않음).
* **`host_permissions`**: `http://165.246.34.137:8080/*` - 지정된 Flask 서버 URL과 통신할 수 있는 권한을 확장 프로그램에 부여합니다.
* **`background`**: `background.js`를 확장 프로그램의 서비스 워커로 지정합니다.
* **`action`**: 크롬 툴바에 표시될 확장 프로그램의 아이콘과 기본 제목을 정의합니다.
* **`icons`**: 확장 프로그램 아이콘의 다양한 크기에 대한 경로를 지정합니다.

---

## 설치 방법

크롬에 이 확장 프로그램을 설치하려면:

1.  프로젝트 저장소를 다운로드하거나 클론합니다.
2.  크롬을 열고 `chrome://extensions`로 이동합니다.
3.  오른쪽 상단에서 **"개발자 모드"** 를 활성화합니다.
4.  **"압축 해제된 확장 프로그램 로드"** 버튼을 클릭하고 확장 프로그램 파일이 있는 디렉터리(`manifest.json` 및 `background.js`가 포함된)를 선택합니다.
5.  "Malware Download Scanner" 확장 프로그램이 이제 확장 프로그램 목록에 나타나 활성화될 것입니다.

---

## 요구 사항

* **Flask 서버**: 이 확장 프로그램은 지정된 `SERVER_URL` (제공된 코드에서는 `http://165.246.34.137:8080`)에서 실행되는 Flask 서버를 필요로 합니다. 이 서버는 URL 및 파일명을 포함하는 POST 요청을 수신하고, 악성코드 분석을 수행하며, `is_malicious` 상태를 나타내는 JSON 응답을 반환할 수 있어야 합니다. 이 Flask 서버의 구현은 이 확장 프로그램 코드의 범위 밖입니다.

---
